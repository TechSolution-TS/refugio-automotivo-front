<div class="modal-overlay" (click)="onClose()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      
      <!-- Header -->
      <div class="modal-header">
        <div class="header-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-label="car">
                <path d="M3 15.5v-2.2c0-.6.3-1.1.7-1.5l2.2-2.1c.4-.4.9-.6 1.5-.6h4.6c.7 0 1.3.3 1.8.8l1.7 1.7 3.4.7c.7.1 1.1.7 1.1 1.3v1.9c0 .6-.4 1-1 1h-1.2"/>
                <path d="M4 15.5h-1c-.6 0-1-.4-1-1v-.6"/>
                <path d="M7 16.5h7.5"/>
                <circle cx="7.5" cy="16.5" r="1.75"/>
                <circle cx="17.5" cy="16.5" r="1.75"/>
                <path d="M7 9.6h4.3c.4 0 .8.2 1.1.4l1.2.9H7.2c-.6 0-1-.5-1-.9 0-.2.2-.4.8-.4z"/>
            </svg>
        </div>
        <h2 class="modal-title">RefÃºgio Automotivo</h2>
        <p class="modal-subtitle">Hoje Ã© um Ã³timo dia para deixar o seu carro brilhando!</p>
        <button class="close-button" (click)="onClose()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
  
      <div class="modal-body">
        
        <!-- SeÃ§Ã£o de busca por CPF -->
        <div *ngIf="!showResults" class="search-section">
          <div class="search-intro">
            <h3 class="section-title">Descubra seus descontos!</h3>
            <p class="section-description">Digite seu CPF e veja se vocÃª tem direito a benefÃ­cios exclusivos</p>
          </div>
  
          <div class="cpf-input-group">
            <input
              type="text"
              class="cpf-input"
              [(ngModel)]="cpf"
              (input)="onCpfInput($event)"
              placeholder="000.000.000-00"
              maxlength="14"
              [disabled]="searching"
            />
            <button 
              class="search-button"
              (click)="buscarDesconto()"
              [disabled]="searching || cpf.length < 14"
              [class.loading]="searching">
              <span *ngIf="!searching">Buscar descontos</span>
              <span *ngIf="searching">Buscando...</span>
            </button>
          </div>
  
          <div *ngIf="error" class="error-message">
            {{ error }}
          </div>
  
          <!-- Lista de Recompensas -->
          <div class="rewards-list">
            <h4 class="rewards-title">Programa de Recompensas</h4>
            <div class="reward-item" *ngFor="let recompensa of recompensas">
              <div class="reward-icon" [style.background]="recompensa.color">
                <svg *ngIf="recompensa.icon === 'tag'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/>
                  <line x1="7" y1="7" x2="7.01" y2="7"/>
                </svg>
                <svg *ngIf="recompensa.icon === 'star'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                </svg>
                <svg *ngIf="recompensa.icon === 'gift'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20 12 20 22 4 22 4 12"/>
                  <rect x="2" y="7" width="20" height="5"/>
                  <line x1="12" y1="22" x2="12" y2="7"/>
                  <path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/>
                  <path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/>
                </svg>
                <svg *ngIf="recompensa.icon === 'trophy'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/>
                  <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/>
                  <path d="M4 22h16"/>
                  <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/>
                  <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/>
                  <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
                </svg>
              </div>
              <div class="reward-info">
                <span class="reward-count">{{ recompensa.lavagens }}Âª lavagem</span>
                <span class="reward-desc">{{ recompensa.descricao }}</span>
              </div>
            </div>
          </div>
        </div>
  
        <!-- Resultado da busca -->
        <div *ngIf="showResults" class="results-section">
          
          <!-- Cliente Encontrado -->
          <div *ngIf="cliente" class="welcome-back">
            <!-- <div class="container-welcome">
              <div class="welcome-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                  <circle cx="12" cy="7" r="4"/>
                </svg>
              </div>
              <div>
                <h3 class="welcome-name">Bem-vindo de volta, {{ cliente.nome.split(' ')[0] }}!</h3>
                <p class="welcome-message">Estamos prontos para cuidar do seu veÃ­culo com padrÃ£o RefÃºgio Automotivo.</p>
              </div>
            </div> -->
  
            <!-- Progresso -->
            <div class="progress-section">
              <div class="progress-header">
                <span class="progress-label">Seu progresso</span>
                <span class="progress-count">{{ cliente.totalSolicitacoes }} / 10 lavagens</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="getProgresso()"></div>
              </div>
            </div>
  
            <!-- Trilha de Recompensas -->
            <div class="rewards-trail">
              <div 
                class="trail-item"
                *ngFor="let recompensa of recompensas"
                [class.completed]="(cliente.totalSolicitacoes || 0) >= recompensa.lavagens"
                [class.current]="getProximaRecompensa()?.lavagens === recompensa.lavagens">
                
                <div class="trail-marker" [style.background]="recompensa.color">
                  <span *ngIf="(cliente.totalSolicitacoes || 0) >= recompensa.lavagens">âœ“</span>
                  <span *ngIf="(cliente.totalSolicitacoes || 0) < recompensa.lavagens">{{ recompensa.lavagens }}</span>
                </div>
                
                <div class="trail-info">
                  <span class="trail-title">{{ recompensa.lavagens }}Âª lavagem</span>
                  <span class="trail-reward">{{ recompensa.descricao }}</span>
                </div>
              </div>
            </div>
  
            <!-- PrÃ³xima Recompensa -->
            <div *ngIf="getProximaRecompensa() && !getRecompensaAtual()" class="next-reward">
              <p class="next-reward-desc">Sua prÃ³xima recompensa: </p>
              <p class="next-reward-desc"><strong>{{ getProximaRecompensa()?.descricao }}</strong></p>
            </div>
  
            <!-- Recompensa AlcanÃ§ada -->
            <div *ngIf="getRecompensaAtual()" class="current-reward">
              <div class="reward-badge">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="8" r="7"/>
                  <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/>
                </svg>
              </div>
              <p class="current-reward-text">VocÃª desbloqueou: <strong>{{ getRecompensaAtual()?.descricao }}</strong></p>
            </div>

             <!-- Em breve Recompensa -->
             <div *ngIf="!getProximaRecompensa() && !getRecompensaAtual()" class="next-reward">
              <p class="next-reward-desc"><strong>VocÃª chegou ao topo! ðŸŽ‰</strong></p>
              <p class="next-reward-desc">Todas as recompensas atuais foram alcanÃ§adas. Em breve estaremos com novas recompesas para vocÃª.</p>
            </div>
          </div>
  
          <!-- Cliente Novo -->
          <div *ngIf="!cliente" class="new-customer">
            <div class="new-customer-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <line x1="19" y1="8" x2="19" y2="14"/>
                <line x1="22" y1="11" x2="16" y2="11"/>
              </svg>
            </div>
            <h3 class="new-customer-title">Seja bem-vindo!</h3>
            <p class="new-customer-message">Este Ã© seu primeiro agendamento. Comece sua jornada de recompensas!</p>
            
            <div class="first-reward">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>
              </svg>
              <p>Na sua 2Âª lavagem vocÃª jÃ¡ ganha 10% de desconto!</p>
            </div>
          </div>
  
          <button class="continue-button" (click)="continuar()">
            Continuar para os serviÃ§os
          </button>
        </div>
  
      </div>
    </div>
  </div>